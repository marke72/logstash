input {
  rabbitmq {
    queue => "netflow-queue"
    exchange => "netflow"
    host => "x.x.x.x"
    durable => true
    port => 5671
    ssl => true
    verify_ssl => true
    prefetch_count => 2048
    threads => 8
    user => ""
    password => ""
  }
}

filter {
  if [type] == "netflow" {
    mutate {
      rename => { "[netflow][flow_seq_num]" => "flow_seq_num" }
      rename => { "[netflow][flowset_id]" => "flowset_id" }
      rename => { "[netflow][in_bytes]" => "in_bytes" }
      rename => { "[netflow][in_pkts]" => "in_pkts" }
      rename => { "[netflow][ipv4_dst_addr]" => "dst_ip" }
      rename => { "[netflow][ipv4_src_addr]" => "src_ip" }
      rename => { "[netflow][l4_dst_port]" => "dst_port" }
      rename => { "[netflow][l4_src_port]" => "src_port" }
      rename => { "[netflow][out_bytes]" => "out_bytes" }
      rename => { "[netflow][out_pkts]" => "out_pkts" }
      rename => { "[netflow][protocol]" => "protocol" }
      rename => { "[netflow][version]" => "version" }
    }

    geoip {
      source => "dst_ip"
      target => "dst_geoip"
    }

    # Field for where the event came from
    if [host] == "10.0.47.1" {
      mutate {
        add_field => { "appliance_name" => "MX100_IDF" }
      }
    }
    else if [host] == "10.2.2.129" {
      mutate {
        add_field => { "appliance_name" => "MX64_SL" }
      }
    }
    else if [host] == "192.168.1.1" {
      mutate {
        add_field => { "appliance_name" => "MX100_PIN" }
      }
    }
    else if [host] == "10.128.0.129" {
      mutate {
        add_field => { "appliance_name" => "MX60_COL" }
      }
    }
    else if [host] == "10.1.1.97" {
      mutate {
        add_field => { "appliance_name" => "MX_TX" }
      }
    }
    else if [host] == "10.1.1.33" {
      mutate {
        add_field => { "appliance_name" => "MX_OR" }
      }
    }
    else if [host] == "10.1.0.193" {
      mutate {
        add_field => { "appliance_name" => "MX_VA" }
      }
    }
    else if [host] == "10.81.0.1" {
      mutate {
        add_field => { "appliance_name" => "MX80_RalNC" }
      }
    }
    else if [host] == "192.168.0.1" {
      mutate {
        add_field => { "appliance_name" => "MX80_RalNC" }
      }
    }
    else if [host] == "10.1.2.33" {
      mutate {
        add_field => { "appliance_name" => "Z1_FarmMW" }
      }
    }
    else if [host] == "10.1.2.169" {
      mutate {
        add_field => { "appliance_name" => "Z1_CellRamona" }
      }
    }
    else if [host] == "10.1.2.161" {
      mutate {
        add_field => { "appliance_name" => "Z1_CellWheatgrass" }
      }
    }
    else if [host] == "10.1.2.65" {
      mutate {
        add_field => { "appliance_name" => "Z1_FarmFH" }
      }
    }
    else if [host] == "10.1.2.49" {
      mutate {
        add_field => { "appliance_name" => "Z1_FarmAFS" }
      }
    }
    else if [host] == "10.1.2.129" {
      mutate {
        add_field => { "appliance_name" => "Z1_FarmMP" }
      }
    }
    else if [host] == "10.2.1.1" {
      mutate {
        add_field => { "appliance_name" => "Z1_FarmRR" }
      }
    }
    else if [host] == "10.2.1.1" {
      mutate {
        add_field => { "appliance_name" => "Z1_FarmRR" }
      }
    }
    else {
      mutate {
        add_field => { "appliance_name" => "updateme" }
      }
    }

    # Add ip_lookup and dshield field
    if [dst_ip] !~ /^10\.(?:[0-9]{1,3}\.){2}[0-9]{1,3}$/ and [dst_ip] !~ /^172\.16\.[0-9]{1,3}\.[0-9]{1,3}$/ and [dst_ip] !~ /^192\.168\.[0-9]{1,3}\.[0-9]{1,3}$/ {
      mutate {
        add_field => { "ip_lookup" => "https://who.is/whois-ip/ip-address/%{dst_ip}" }
        add_field => { "dshield_dst" => "http://dshield.org/ipinfo.html?ip=%{dst_ip}" }
      }
    }

    # Add field protocol_name based on the value in protocol
    if [protocol] == 0 {
      mutate {
        add_field => { "protocol_name" => "hopopt" }
      }
    }
    else if [protocol] == 1 {
      mutate {
        add_field => { "protocol_name" => "icmp" }
      }
    }
    else if [protocol] == 2 {
      mutate {
        add_field => { "protocol_name" => "igmp" }
      }
    }
    else if [protocol] == 3 {
      mutate {
        add_field => { "protocol_name" => "ggp" }
      }
    }
    else if [protocol] == 4 {
      mutate {
        add_field => { "protocol_name" => "ip" }
      }
    }
    else if [protocol] == 5 {
      mutate {
        add_field => { "protocol_name" => "igmp" }
      }
    }
    else if [protocol] == 6 {
      mutate {
        add_field => { "protocol_name" => "tcp" }
      }
    }
    else if [protocol] == 7 {
      mutate {
        add_field => { "protocol_name" => "cbt" }
      }
    }
    else if [protocol] == 8 {
      mutate {
        add_field => { "protocol_name" => "egp" }
      }
    }
    else if [protocol] == 9 {
      mutate {
        add_field => { "protocol_name" => "igp" }
      }
    }
    else if [protocol] == 10 {
      mutate {
        add_field => { "protocol_name" => "bbn-rcc-mon" }
      }
    }
    else if [protocol] == 11 {
      mutate {
        add_field => { "protocol_name" => "nvp-ii" }
      }
    }
    else if [protocol] == 12 {
      mutate {
        add_field => { "protocol_name" => "pup" }
      }
    }
    else if [protocol] == 13 {
      mutate {
        add_field => { "protocol_name" => "argus" }
      }
    }
    else if [protocol] == 14 {
      mutate {
        add_field => { "protocol_name" => "emcon" }
      }
    }
    else if [protocol] == 15 {
      mutate {
        add_field => { "protocol_name" => "xnet" }
      }
    }
    else if [protocol] == 16 {
      mutate {
        add_field => { "protocol_name" => "chaos" }
      }
    }
    else if [protocol] == 17 {
      mutate {
        add_field => { "protocol_name" => "udp" }
      }
    }
    else if [protocol] == 18 {
      mutate {
        add_field => { "protocol_name" => "mux" }
      }
    }
    else if [protocol] == 19 {
      mutate {
        add_field => { "protocol_name" => "dcn-meas" }
      }
    }
    else if [protocol] == 20 {
      mutate {
        add_field => { "protocol_name" => "hmp" }
      }
    }
    else if [protocol] == 21 {
      mutate {
        add_field => { "protocol_name" => "prm" }
      }
    }
    else if [protocol] == 22 {
      mutate {
        add_field => { "protocol_name" => "xns-idp" }
      }
    }
    else if [protocol] == 23 {
      mutate {
        add_field => { "protocol_name" => "trunk-1" }
      }
    }
    else if [protocol] == 24 {
      mutate {
        add_field => { "protocol_name" => "trunk-2" }
      }
    }
    else if [protocol] == 25 {
      mutate {
        add_field => { "protocol_name" => "leaf-1" }
      }
    }
    else if [protocol] == 26 {
      mutate {
        add_field => { "protocol_name" => "leaf-2" }
      }
    }
    else if [protocol] == 27 {
      mutate {
        add_field => { "protocol_name" => "rdp" }
      }
    }
    else if [protocol] == 28 {
      mutate {
        add_field => { "protocol_name" => "irtp" }
      }
    }
    else if [protocol] == 29 {
      mutate {
        add_field => { "protocol_name" => "iso-tp4" }
      }
    }
    else if [protocol] == 30 {
      mutate {
        add_field => { "protocol_name" => "netblt" }      }
    }
    else if [protocol] == 31 {
      mutate {
        add_field => { "protocol_name" => "mfe-nsp" }
      }
    }
    else if [protocol] == 32 {
      mutate {
        add_field => { "protocol_name" => "merit-inp" }
      }
    }
    else if [protocol] == 33 {
      mutate {
        add_field => { "protocol_name" => "sep" }
      }
    }
    else if [protocol] == 34 {
      mutate {
        add_field => { "protocol_name" => "3pc" }
      }
    }
    else if [protocol] == 35 {
      mutate {
        add_field => { "protocol_name" => "idpr" }
      }
    }
    else if [protocol] == 36 {
      mutate {
        add_field => { "protocol_name" => "xtp" }
      }
    }
    else if [protocol] == 37 {
      mutate {
        add_field => { "protocol_name" => "ddp" }
      }
    }
    else if [protocol] == 38 {
      mutate {
        add_field => { "protocol_name" => "idpr-cmtp" }
      }
    }
    else if [protocol] == 39 {
      mutate {
        add_field => { "protocol_name" => "tp++" }
      }
    }
    else if [protocol] == 40 {
      mutate {
        add_field => { "protocol_name" => "il" }
      }
    }
    else if [protocol] == 41 {
      mutate {
        add_field => { "protocol_name" => "ipv6" }
      }
    }
    else if [protocol] == 42 {
      mutate {
        add_field => { "protocol_name" => "sdrp" }
      }
    }
    else if [protocol] == 43 {
      mutate {
        add_field => { "protocol_name" => "ipv6-route" }
      }
    }
    else if [protocol] == 44 {
      mutate {
        add_field => { "protocol_name" => "ipv6-frag" }
      }
    }
    else if [protocol] == 45 {
      mutate {
        add_field => { "protocol_name" => "idrp" }
      }
    }
    else if [protocol] == 46 {
      mutate {
        add_field => { "protocol_name" => "rsvp" }
      }
    }
    else if [protocol] == 47 {
      mutate {
        add_field => { "protocol_name" => "gre" }
      }
    }
    else if [protocol] == 48 {
      mutate {
        add_field => { "protocol_name" => "mhrp" }
      }
    }
    else if [protocol] == 49 {
      mutate {
        add_field => { "protocol_name" => "bna" }
      }
    }
    else if [protocol] == 50 {
      mutate {
        add_field => { "protocol_name" => "esp" }
      }
    }
    else if [protocol] == 51 {
      mutate {
        add_field => { "protocol_name" => "ah" }
      }
    }
    else if [protocol] == 52 {
      mutate {
        add_field => { "protocol_name" => "i-nlsp" }
      }
    }
    else if [protocol] == 53 {
      mutate {
        add_field => { "protocol_name" => "swipe" }
      }
    }
    else if [protocol] == 54 {
      mutate {
        add_field => { "protocol_name" => "narp" }
      }
    }
    else if [protocol] == 55 {
      mutate {
        add_field => { "protocol_name" => "mobile" }
      }
    }
    else if [protocol] == 56 {
      mutate {
        add_field => { "protocol_name" => "tlsp" }
      }
    }
    else if [protocol] == 57 {
      mutate {
        add_field => { "protocol_name" => "skip" }
      }
    }
    else if [protocol] == 58 {
      mutate {
        add_field => { "protocol_name" => "ipv6-icmp" }
      }
    }
    else if [protocol] == 59 {
      mutate {
        add_field => { "protocol_name" => "ipv6-nonxt" }
      }
    }
    else if [protocol] == 60 {
      mutate {
        add_field => { "protocol_name" => "ipv6-opts" }
      }
    }
    else if [protocol] == 61 {
      mutate {
        add_field => { "protocol_name" => "any-host-internal-protocol" }
      }
    }
    else if [protocol] == 62 {
      mutate {
        add_field => { "protocol_name" => "cftp" }
      }
    }
    else if [protocol] == 63 {
      mutate {
        add_field => { "protocol_name" => "any-local-network" }
      }
    }
    else if [protocol] == 64 {
      mutate {
        add_field => { "protocol_name" => "sat-expak" }
      }
    }
    else if [protocol] == 65 {
      mutate {
        add_field => { "protocol_name" => "kryptolan" }
      }
    }
    else if [protocol] == 66 {
      mutate {
        add_field => { "protocol_name" => "rvd" }
      }
    }
    else if [protocol] == 67 {
      mutate {
        add_field => { "protocol_name" => "ippc" }
      }
    }
    else if [protocol] == 68 {
      mutate {
        add_field => { "protocol_name" => "any-distributed-file-system" }
      }
    }
    else if [protocol] == 69 {
      mutate {
        add_field => { "protocol_name" => "sat-mon" }
      }
    }
    else if [protocol] == 70 {
      mutate {
        add_field => { "protocol_name" => "visa" }
      }
    }
    else if [protocol] == 71 {
      mutate {
        add_field => { "protocol_name" => "ipcv" }
      }
    }
    else if [protocol] == 72 {
      mutate {
        add_field => { "protocol_name" => "cpnx" }
      }
    }
    else if [protocol] == 73 {
      mutate {
        add_field => { "protocol_name" => "cphb" }
      }
    }
    else if [protocol] == 74 {
      mutate {
        add_field => { "protocol_name" => "wsn" }
      }
    }
    else if [protocol] == 75 {
      mutate {
        add_field => { "protocol_name" => "pvp" }
      }
    }
    else if [protocol] == 76 {
      mutate {
        add_field => { "protocol_name" => "br-sat-mon" }
      }
    }
    else if [protocol] == 77 {
      mutate {
        add_field => { "protocol_name" => "sun-nd" }
      }
    }
    else if [protocol] == 78 {
      mutate {
        add_field => { "protocol_name" => "wb-mon" }
      }
    }
    else if [protocol] == 79 {
      mutate {
        add_field => { "protocol_name" => "wb-expak" }
      }
    }
    else if [protocol] == 80 {
      mutate {
        add_field => { "protocol_name" => "iso-ip" }
      }
    }
    else if [protocol] == 81 {
      mutate {
        add_field => { "protocol_name" => "vmtp" }
      }
    }
    else if [protocol] == 82 {
      mutate {
        add_field => { "protocol_name" => "sercure-vmtp" }
      }
    }
    else if [protocol] == 83 {
      mutate {
        add_field => { "protocol_name" => "vines" }
      }
    }
    else if [protocol] == 84 {
      mutate {
        add_field => { "protocol_name" => "ttp" }
      }
    }
    else if [protocol] == 85 {
      mutate {
        add_field => { "protocol_name" => "nsfnet-gip" }
      }
    }
    else if [protocol] == 86 {
      mutate {
        add_field => { "protocol_name" => "dgp" }
      }
    }
    else if [protocol] == 87 {
      mutate {
        add_field => { "protocol_name" => "tcf" }
      }
    }
    else if [protocol] == 88 {
      mutate {
        add_field => { "protocol_name" => "eigrp" }
      }
    }
    else if [protocol] == 89 {
      mutate {
        add_field => { "protocol_name" => "ospfigp" }
      }
    }
    else if [protocol] == 90 {
      mutate {
        add_field => { "protocol_name" => "sprite-rpc" }
      }
    }
    else if [protocol] == 91 {
      mutate {
        add_field => { "protocol_name" => "larp" }
      }
    }
    else if [protocol] == 92 {
      mutate {
        add_field => { "protocol_name" => "mtp" }
      }
    }
    else if [protocol] == 93 {
      mutate {
        add_field => { "protocol_name" => "ax.25" }
      }
    }
    else if [protocol] == 94 {
      mutate {
        add_field => { "protocol_name" => "ipip" }
      }
    }
    else if [protocol] == 95 {
      mutate {
        add_field => { "protocol_name" => "micp" }
      }
    }
    else if [protocol] == 96 {
      mutate {
        add_field => { "protocol_name" => "scc-sp" }
      }
    }
    else if [protocol] == 97 {
      mutate {
        add_field => { "protocol_name" => "etherip" }
      }
    }
    else if [protocol] == 98 {
      mutate {
        add_field => { "protocol_name" => "encap" }
      }
    }
    else if [protocol] == 99 {
      mutate {
        add_field => { "protocol_name" => "any-privite-encryption" }
      }
    }
    else if [protocol] == 100 {
      mutate {
        add_field => { "protocol_name" => "gmtp" }
      }
    }
    else if [protocol] == 101 {
      mutate {
        add_field => { "protocol_name" => "ifmp" }
      }
    }
    else if [protocol] == 102 {
      mutate {
        add_field => { "protocol_name" => "pnni" }
      }
    }
    else if [protocol] == 103 {
      mutate {
        add_field => { "protocol_name" => "pim" }
      }
    }
    else if [protocol] == 104 {
      mutate {
        add_field => { "protocol_name" => "aris" }
      }
    }
    else if [protocol] == 105 {
      mutate {
        add_field => { "protocol_name" => "scps" }
      }
    }
    else if [protocol] == 106 {
      mutate {
        add_field => { "protocol_name" => "qnx" }
      }
    }
    else if [protocol] == 107 {
      mutate {
        add_field => { "protocol_name" => "a/n" }
      }
    }
    else if [protocol] == 108 {
      mutate {
        add_field => { "protocol_name" => "ipcomp" }
      }
    }
    else if [protocol] == 109 {
      mutate {
        add_field => { "protocol_name" => "snp" }
      }
    }
    else if [protocol] == 110 {
      mutate {
        add_field => { "protocol_name" => "compaq-peer" }
      }
    }
    else if [protocol] == 111 {
      mutate {
        add_field => { "protocol_name" => "ipx-in-ip" }
      }
    }
    else if [protocol] == 112 {
      mutate {
        add_field => { "protocol_name" => "vrrp" }
      }
    }
    else if [protocol] == 113 {
      mutate {
        add_field => { "protocol_name" => "pgm" }
      }
    }
    else if [protocol] == 114 {
      mutate {
        add_field => { "protocol_name" => "any-0-hop" }
      }
    }
    else if [protocol] == 115 {
      mutate {
        add_field => { "protocol_name" => "l2tp" }
      }
    }
    else if [protocol] == 116 {
      mutate {
        add_field => { "protocol_name" => "ddx" }
      }
    }
    else if [protocol] == 117 {
      mutate {
        add_field => { "protocol_name" => "iatp" }
      }
    }
    else if [protocol] == 118 {
      mutate {
        add_field => { "protocol_name" => "stp" }
      }
    }
    else if [protocol] == 119 {
      mutate {
        add_field => { "protocol_name" => "srp" }
      }
    }
    else if [protocol] == 120 {
      mutate {
        add_field => { "protocol_name" => "uti" }
      }
    }
    else if [protocol] == 121 {
      mutate {
        add_field => { "protocol_name" => "smp" }
      }
    }
    else if [protocol] == 122 {
      mutate {
        add_field => { "protocol_name" => "sm" }
      }
    }
    else if [protocol] == 123 {
      mutate {
        add_field => { "protocol_name" => "ptp" }
      }
    }
    else if [protocol] == 124 {
      mutate {
        add_field => { "protocol_name" => "isis" }
      }
    }
    else if [protocol] == 125 {
      mutate {
        add_field => { "protocol_name" => "fire" }
      }
    }
    else if [protocol] == 126 {
      mutate {
        add_field => { "protocol_name" => "crtp" }
      }
    }
    else if [protocol] == 127 {
      mutate {
        add_field => { "protocol_name" => "crudp" }
      }
    }
    else if [protocol] == 128 {
      mutate {
        add_field => { "protocol_name" => "sscopmce" }
      }
    }
    else if [protocol] == 129 {
      mutate {
        add_field => { "protocol_name" => "iplt" }
      }
    }
    else if [protocol] == 130 {
      mutate {
        add_field => { "protocol_name" => "sps" }
      }
    }
    else if [protocol] == 131 {
      mutate {
        add_field => { "protocol_name" => "pipe" }
      }
    }
    else if [protocol] == 132 {
      mutate {
        add_field => { "protocol_name" => "sctp" }
      }
    }
    else if [protocol] == 133 {
      mutate {
        add_field => { "protocol_name" => "fc" }
      }
    }
    else if [protocol] == 134 {
      mutate {
        add_field => { "protocol_name" => "rsvp-e2e-ignore" }
      }
    }
    else if [protocol] == 255 {
      mutate {
        add_field => { "protocol_name" => "reserverd" }
      }
    }
    else {
      mutate {
        add_field => { "protocol_name" => "unassigned" }
      }
    }
  }
}

output {
  if [type] == "netflow" {
    elasticsearch {
      ssl => true
      ssl_certificate_verification => false
      user => ""
      password => ""
      hosts => ["https://x.x.x.x:9200"]
      index => "netflow-%{+YYYY.MM.dd}"
      manage_template => false
    }
  }
}
